const translations = {
    "en": {
        "nav_play_games": "Play Games",
        "nav_store": "Store",
        "nav_leaderboard": "Leaderboard",
        "nav_career": "Career",
        "nav_about": "About Us",
        "nav_account": "Account",
        "lang_toggle": "العربية",
        "theme_toggle_light": "Light Mode",
        "theme_toggle_dark": "Dark Mode",
        "login_link": "Log In",
        "signup_link": "Sign Up",
        "logout_link": "Log Out",
        "user_credits_nav_prefix": "Credits: ", // For navbar display
        "main_title_img_alt": "Matharoon Logo",
        "idx_game_hub_title": "Enter the Game Hub",
        "idx_game_hub_p": "Choose your math adventure: Speed Drill or the new RoonRun!",
        "idx_game_hub_img_alt": "Play Games Icon",
        "idx_store_title": "Visit the Store",
        "idx_store_p": "Get new characters for RoonRun and other cool items!",
        "idx_store_img_alt": "Store Icon",
        "idx_leaderboard_title": "Leaderboards",
        "idx_leaderboard_p": "See who is topping the charts in Matharoon challenges!",
        "idx_leaderboard_img_alt": "Leaderboard Icon",
        "idx_news_title": "Latest News",
        "idx_news_loading": "Loading news...",
        "footer_matharoon": "Matharoon © 2025 - MRROON=33",
        "login_required_title": "Login Required",
        "login_required_text": "You need to be logged in to access this page.",
        "login_button": "Login",
        "signup_button": "Sign Up",
        "welcome_to_matharoon": "Welcome to Matharoon!",
        "your_ultimate_destination": "Your ultimate destination for fun and educational math games.",
        "explore_games": "Explore Games",
        "about_us_title": "About Us",
        "about_us_p1": "Matharoon is dedicated to making math learning an exciting adventure for students of all ages.",
        "about_us_p2": "Our interactive games are designed to build strong mathematical foundations while ensuring a fun experience.",
        "leaderboard_title": "Leaderboard",
        "select_game": "Select Game:",
        "speed_drill_game": "Speed Drill",
        "roon_run_game": "RoonRun",
        "rank": "Rank",
        "player": "Player",
        "score": "Score",
        "store_page_title": "Character Store",
        "store_credits_label": "Your Credits",
        "store_buy_credits_button": "Buy Credits",
        "store_browse_intro": "Browse unique characters and their poses. Click and drag or swipe on a character to see its different styles!",
        "store_back_to_main_button": "Back to Main Page",
        "store_item_owned": "Owned",
        "store_item_buy": "Buy",
        "store_item_not_enough_credits": "Not Enough Credits",
        "store_item_get_free": "Get (Free)",
        "store_item_login_to_buy": "Log in to Buy/Get",
        "store_item_price_label": "Price:",
        "store_item_credits_suffix": "Credits",
        "game_hub_title": "Game Hub",
        "select_a_game_to_play": "Select a game to play:",
        "speed_drill_description": "Test your calculation speed!",
        "roon_run_description": "Run and solve math problems!",
        "game_panel_title": "Speed Drill Challenge",
        "question": "Question:",
        "answer": "Answer:",
        "submit_answer": "Submit",
        "time_left": "Time Left:",
        "start_game": "Start Game",
        "logged_in_as": "Logged in as:",
        "logout": "Logout",
        "login_title": "Login to Matharoon",
        "signup_page_title": "Sign Up for Matharoon",
        "email_label": "Email",
        "password_label": "Password",
        "display_name_label": "Display Name",
        "career_history_title": "Career History",
        "no_history": "No game history yet. Play some games!",
        "roon_run_instructions_title": "RoonRun Instructions",
        "roon_run_instructions_p1": "The character runs automatically. Answer math questions correctly to jump over obstacles.",
        "roon_run_choose_char": "Choose Your Character",
        "alert_store_unavailable": "Error: Store services are currently unavailable. Please try again later.",
        "alert_auth_failed": "Authentication failed. Please try again.",
        "alert_invalid_user_char_id": "Invalid user or character ID.",
        "alert_fetch_user_data_failed": "Could not fetch user data.",
        "alert_char_already_owned": "Character already owned.",
        "alert_purchase_processing_error": "Error processing purchase.",
        "alert_not_enough_credits": "Not enough credits.",
        "alert_purchase_successful": "Purchase successful!",
        "alert_login_to_purchase": "You must be logged in to purchase items.",
        "alert_confirm_purchase_prefix": "Are you sure you want to ",
        "alert_confirm_purchase_get": "get",
        "alert_confirm_purchase_buy": "buy",
        "alert_confirm_purchase_suffix_name": " {itemName} for {itemPrice} Credits?",
        "alert_credits_added": "{amount} Credits added! (May take a moment to reflect)",
        "alert_add_credits_failed": "Failed to add credits.",
        "alert_login_to_buy_credits": "Please log in to buy credits.",
        "signup_success_redirect": "Sign up successful! Redirecting...",
        "login_success_redirect": "Login successful! Redirecting...",
        "error_prefix": "Error: "
    },
    "ar": {
        "nav_play_games": "العب الألعاب",
        "nav_store": "المتجر",
        "nav_leaderboard": "لوحة الصدارة",
        "nav_career": "المسيرة",
        "nav_about": "من نحن",
        "nav_account": "الحساب",
        "lang_toggle": "English",
        "theme_toggle_light": "الوضع الفاتح",
        "theme_toggle_dark": "الوضع الداكن",
        "login_link": "تسجيل الدخول",
        "signup_link": "إنشاء حساب",
        "logout_link": "تسجيل الخروج",
        "user_credits_nav_prefix": "الرصيد: ",
        "main_title_img_alt": "شعار ماثارون",
        "idx_game_hub_title": "ادخل مركز الألعاب",
        "idx_game_hub_p": "!اختر مغامرتك الرياضية: سبيد دريل أو رون رن الجديدة",
        "idx_game_hub_img_alt": "أيقونة لعب الألعاب",
        "idx_store_title": "زر المتجر",
        "idx_store_p": "!احصل على شخصيات جديدة لـ رون رن وعناصر رائعة أخرى",
        "idx_store_img_alt": "أيقونة المتجر",
        "idx_leaderboard_title": "لوحة الصدارة",
        "idx_leaderboard_p": "!شاهد من يتصدر القوائم في تحديات ماثارون",
        "idx_leaderboard_img_alt": "أيقونة لوحة الصدارة",
        "idx_news_title": "آخر الأخبار",
        "idx_news_loading": "...جاري تحميل الأخبار",
        "footer_matharoon": "ماثارون © 2025 - Matharoon.com",
        "login_required_title": "تسجيل الدخول مطلوب",
        "login_required_text": "تحتاج إلى تسجيل الدخول للوصول إلى هذه الصفحة.",
        "login_button": "تسجيل الدخول",
        "signup_button": "إنشاء حساب",
        "welcome_to_matharoon": "!مرحباً بك في ماثارون",
        "your_ultimate_destination": ".وجهتك المثالية لألعاب الرياضيات الممتعة والتعليمية",
        "explore_games": "استكشف الألعاب",
        "about_us_title": "من نحن",
        "about_us_p1": ".ماثارون مكرس لجعل تعلم الرياضيات مغامرة مثيرة للطلاب من جميع الأعمار",
        "about_us_p2": ".تم تصميم ألعابنا التفاعلية لبناء أسس رياضية قوية مع ضمان تجربة ممتعة",
        "leaderboard_title": "لوحة الصدارة",
        "select_game": ":اختر اللعبة",
        "speed_drill_game": "سبيد دريل",
        "roon_run_game": "رون رن",
        "rank": "الترتيب",
        "player": "اللاعب",
        "score": "النقاط",
        "store_page_title": "متجر الشخصيات",
        "store_credits_label": "رصيدك",
        "store_buy_credits_button": "شراء رصيد",
        "store_browse_intro": "!تصفح الشخصيات الفريدة ووقفاتها. انقر واسحب أو مرر على الشخصية لرؤية أنماطها المختلفة",
        "store_back_to_main_button": "العودة إلى الصفحة الرئيسية",
        "store_item_owned": "مملوك",
        "store_item_buy": "شراء",
        "store_item_not_enough_credits": "لا يوجد رصيد كافٍ",
        "store_item_get_free": "احصل (مجاني)",
        "store_item_login_to_buy": "سجل الدخول للشراء/الحصول",
        "store_item_price_label": ":السعر",
        "store_item_credits_suffix": "رصيد",
        "game_hub_title": "مركز الألعاب",
        "select_a_game_to_play": ":اختر لعبة لتلعبها",
        "speed_drill_description": "!اختبر سرعة حسابك",
        "roon_run_description": "!اركض وحل مسائل الرياضيات",
        "game_panel_title": "تحدي سبيد دريل",
        "question": ":السؤال",
        "answer": ":الإجابة",
        "submit_answer": "إرسال",
        "time_left": ":الوقت المتبقي",
        "start_game": "ابدأ اللعبة",
        "logged_in_as": ":تم تسجيل الدخول باسم",
        "logout": "تسجيل الخروج",
        "login_title": "تسجيل الدخول إلى ماثارون",
        "signup_page_title": "إنشاء حساب في ماثارون",
        "email_label": "البريد الإلكتروني",
        "password_label": "كلمة المرور",
        "display_name_label": "اسم العرض",
        "career_history_title": "تاريخ المسيرة",
        "no_history": ".لا يوجد تاريخ ألعاب حتى الآن. العب بعض الألعاب",
        "roon_run_instructions_title": "تعليمات رون رن",
        "roon_run_instructions_p1": ".الشخصية تركض تلقائيًا. أجب على أسئلة الرياضيات بشكل صحيح للقفز فوق العقبات",
        "roon_run_choose_char": "اختر شخصيتك",
        "alert_store_unavailable": ".خطأ: خدمات المتجر غير متوفرة حاليًا. يرجى المحاولة مرة أخرى لاحقًا",
        "alert_auth_failed": ".فشل المصادقة. يرجى المحاولة مرة أخرى",
        "alert_invalid_user_char_id": ".معرف مستخدم أو شخصية غير صالح",
        "alert_fetch_user_data_failed": ".تعذر جلب بيانات المستخدم",
        "alert_char_already_owned": ".الشخصية مملوكة بالفعل",
        "alert_purchase_processing_error": ".خطأ في معالجة الشراء",
        "alert_not_enough_credits": ".لا يوجد رصيد كافٍ",
        "alert_purchase_successful": "!تم الشراء بنجاح",
        "alert_login_to_purchase": ".يجب عليك تسجيل الدخول لشراء العناصر",
        "alert_confirm_purchase_prefix": "هل أنت متأكد أنك تريد ",
        "alert_confirm_purchase_get": "الحصول على",
        "alert_confirm_purchase_buy": "شراء",
        "alert_confirm_purchase_suffix_name": " {itemName} مقابل {itemPrice} رصيد؟",
        "alert_credits_added": "!تمت إضافة {amount} رصيد (قد يستغرق الأمر لحظة ليظهر)",
        "alert_add_credits_failed": ".فشل إضافة الرصيد",
        "alert_login_to_buy_credits": ".يرجى تسجيل الدخول لشراء الرصيد",
        "signup_success_redirect": "!تم إنشاء الحساب بنجاح! جارٍ إعادة التوجيه...",
        "login_success_redirect": "!تم تسجيل الدخول بنجاح! جارٍ إعادة التوجيه...",
        "error_prefix": ":خطأ "
    }
};

// Function to apply translations - to be called by language_switcher.js or individual pages
function applyTranslations(lang) {
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                if (element.placeholder) element.placeholder = translations[lang][key];
            } else if (element.tagName === 'IMG') {
                if (element.alt) element.alt = translations[lang][key];
            } else {
                element.innerHTML = translations[lang][key]; // Use innerHTML to allow for simple tags if needed in future
            }
        }
    });
    // Special handling for dynamic elements or titles
    if (document.title && translations[lang][document.documentElement.getAttribute('data-translate-title')]) {
        document.title = translations[lang][document.documentElement.getAttribute('data-translate-title')];
    }

    // Update lang attribute and dir for RTL
    document.documentElement.lang = lang;
    if (lang === 'ar') {
        document.documentElement.dir = 'rtl';
        // Add a class to body for RTL specific styles if needed
        document.body.classList.add('rtl-layout');
        document.body.classList.remove('ltr-layout');
    } else {
        document.documentElement.dir = 'ltr';
        document.body.classList.add('ltr-layout');
        document.body.classList.remove('rtl-layout');
    }
    // Update the language toggle button text
    const langToggleButton = document.getElementById('languageToggleBtn'); // Assuming a button with this ID
    if (langToggleButton && translations[lang] && translations[lang]['lang_toggle']) {
        langToggleButton.textContent = translations[lang === 'en' ? 'ar' : 'en']['lang_toggle']; // Show the *other* language
    }
}

// Function to get a translated string, for use in JS for dynamic content like alerts
function getTranslatedString(key, lang, replacements = {}) {
    let currentLang = lang || document.documentElement.lang || 'en';
    if (translations[currentLang] && translations[currentLang][key]) {
        let translated = translations[currentLang][key];
        for (const placeholder in replacements) {
            translated = translated.replace(`{${placeholder}}`, replacements[placeholder]);
        }
        return translated;
    } else if (translations['en'] && translations['en'][key]) { // Fallback to English
        let translated = translations['en'][key];
        for (const placeholder in replacements) {
            translated = translated.replace(`{${placeholder}}`, replacements[placeholder]);
        }
        return translated;
    }
    return key; // Fallback to key if no translation found
}

// Initial theme toggle text setup
function updateThemeToggleButtonText(currentLang) {
    const themeToggleBtn = document.querySelector(".theme-toggle");
    if (themeToggleBtn) {
        const isLight = document.body.classList.contains("light-mode");
        const key = isLight ? "theme_toggle_dark" : "theme_toggle_light";
        themeToggleBtn.textContent = getTranslatedString(key, currentLang);
    }
}

console.log("translations.js loaded with new strings and helper functions.");

